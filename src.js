!function(){"use strict";var i,s,n=function(t,e,i,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t===e&&n:e.has(t))return"a"===s?n.call(t,i):n?n.value=i:e.set(t,i),i;throw new TypeError("Cannot write private member to an object whose class did not declare it")},t=function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t===e&&s:e.has(t))return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t);throw new TypeError("Cannot read private member from an object whose class did not declare it")};class d{constructor(t,e){i.set(this,void 0),s.set(this,void 0),n(this,i,t,"f"),n(this,s,e,"f")}get x(){return t(this,i,"f")}get y(){return t(this,s,"f")}add(t){return new d(this.x+t.x,this.y+t.y)}negate(){return new d(-this.x,-this.y)}subtract(t){return this.add(t.negate())}multiply(t,e){return void 0===e&&(e=t),new d(this.x*t,this.y*e)}divide(t){return new d(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return(this.x**2+this.y**2)**.5}normalize(){return new d(this.x/this.length(),this.y/this.length())}angle(){return 0===this.x&&0===this.y?0:Math.atan2(this.y,this.x)}rotate(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),t=this.x*Math.sin(t)+this.y*Math.cos(t);return new d(e,t)}setLength(t){t=this.length()/t;return new d(this.x/t,this.y/t)}}function r(){return"#"+(t=0,e=16777215,Math.round(Math.random()*(e-t)+t).toString(16).padStart(6,"0"));var t,e}function a(t,e,i,s,n,r){t.lineWidth=r;const o=t.createLinearGradient(e.x,e.y,i.x,i.y);o.addColorStop(0,s),o.addColorStop(1,n),t.strokeStyle=o,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.stroke()}function h(t,e,i){var s=Math.min(e,i),e=(t.x-e/2)/(s/2),t=(t.y-i/2)/(s/2);return new d(e,t)}function c(t,e,i){var s=Math.min(e,i),e=t.x*(s/2)+e/2,t=t.y*(s/2)+i/2;return new d(e,t)}i=new WeakMap,s=new WeakMap;class o extends MouseEvent{constructor(t,e,i){super(t.type,t);t=h(new d(this.clientX,this.clientY),e,i),[this.physicsX,this.physicsY]=[t.x,t.y],t=Math.min(e,i),e=new d(this.movementX/t*2,this.movementY/t*2);[this.physicsMovementX,this.physicsMovementY]=[e.x,e.y]}}class l{constructor(t,e="#000",i=1,s){this.deleted=!1,this.coords=t,this.velocity=new d(0,0),this.pushKoef=i,this.color=e,this.renderer=s,this.isDragged=!1,this.draggedOffset=new d(0,0)}render(t){const e=Math.min(t.canvas.width,t.canvas.height),i=c(this.coords,t.canvas.width,t.canvas.height);var s=this.isDragged?1:0;this.renderer.pend(()=>{t.fillStyle=this.color,t.beginPath(),t.arc(i.x,i.y,l.radius*e/2,0,2*Math.PI),t.fill()},1+s),this.renderer.pend(()=>{t.beginPath(),t.lineWidth=1,t.strokeStyle=l.outlineColor,t.arc(i.x,i.y,l.radius*e/2,0,2*Math.PI),t.stroke()},10+s)}prePhysics(){this.velocity=new d(0,0)}applyVelocity(t,e){for(const i of e)if(i!==this&&i instanceof l){const s=this.coords.subtract(i.coords);this.velocity=this.velocity.add(s.divide(Math.max(s.length()**3,Number.EPSILON)).multiply(this.pushKoef))}}applyCoords(t,e){this.isDragged||(this.coords=this.coords.add(this.velocity.multiply(t)))}applyInput(t,e){var i;t instanceof o&&(i=this.isInsideVertex(new d(t.physicsX,t.physicsY)),"mousedown"===t.type&&!t.shiftKey&&i&&(this.isDragged=!0,this.draggedOffset=new d(t.physicsX,t.physicsY).subtract(this.coords)),"mouseup"===t.type&&(this.isDragged=!1),"mousemove"===t.type&&this.isDragged&&(this.coords=new d(t.physicsX,t.physicsY).subtract(this.draggedOffset)),"click"===t.type&&i&&t.ctrlKey&&(this.deleted=!0))}isInsideVertex(t){return t=t,e=this.coords,i=l.radius,t.subtract(e).length()<=i;var e,i}}l.radius=.02,l.outlineColor="black";class u{constructor(t,e){this.deleted=!1,this.renderer=e,this.from=t,this.to=t.coords}render(t){var[e,i]=[t.canvas.width,t.canvas.height];const s=c(this.to,e,i),n=c(this.from.coords,e,i),r=s.subtract(n);if(0!==r.length()){e=Math.min(e,i),i=e*l.radius/2;const o=n.add(r.setLength(i)),h=u.width*e;this.renderer.pend(()=>{a(t,o,s,this.from.color,u.endColor,h)},0)}}applyInput(t,e){t instanceof o&&"mousemove"===t.type&&(this.to=new d(t.physicsX,t.physicsY))}}u.width=.005,u.endColor="black";class p{constructor(t,e,i=1,s){this._deleted=!1,this.renderer=s,this.vertices=[t,e],this.pullKoef=i}get deleted(){return this.vertices[0].deleted||this.vertices[1].deleted||this._deleted}render(t){var[e,i]=[t.canvas.width,t.canvas.height];const s=c(this.vertices[1].coords,e,i),n=c(this.vertices[0].coords,e,i),r=s.subtract(n);if(0!==r.length()){e=Math.min(e,i),i=e*l.radius/2;const o=n.add(r.setLength(i)),h=s.add(r.negate().setLength(i)),d=p.renderWidthMult*e;this.renderer.pend(()=>{a(t,o,h,this.vertices[0].color,this.vertices[1].color,d)},0)}}applyVelocity(t){let e=this.vertices[1].coords.subtract(this.vertices[0].coords);this.vertices[0].velocity=this.vertices[0].velocity.add(e.multiply(this.pullKoef)),e=this.vertices[0].coords.subtract(this.vertices[1].coords),this.vertices[1].velocity=this.vertices[1].velocity.add(e.multiply(this.pullKoef))}applyInput(t,e){if(t instanceof o){const s=this.vertices[1].coords.subtract(this.vertices[0].coords);var i=s.length()-2*l.radius,i=function(t,e,i,s,n){const r=t.subtract(e);return t=r.rotate(-n),Math.abs(t.x)<s/2&&Math.abs(t.y)<i/2}(new d(t.physicsX,t.physicsY),this.vertices[0].coords.add(s.divide(2)),p.renderWidthMult*p.targetWidthMult*2,i,s.angle());"click"===t.type&&i&&t.ctrlKey&&(this._deleted=!0)}}}p.renderWidthMult=.005,p.targetWidthMult=2;class y{constructor(t){this.deleted=!1,this.active=t}postPhysics(i,s){if(this.active&&!s.some(t=>t instanceof l&&t.isDragged)){let t=new d(0,0),e=0;for(const n of s)n instanceof l&&(t=t.add(n.coords),e++);if(0!==e){t=t.divide(e);const r=new d(0,0),o=r.subtract(t);for(const h of s)h instanceof l&&(h.coords=h.coords.add(o.multiply(y.velocityMult).multiply(i)))}}}applyInput(t,e){t instanceof KeyboardEvent&&"keydown"===t.type&&"KeyC"===t.code&&(this.active=!this.active)}}y.velocityMult=1;class e{constructor(t,e){this.deleted=!1,this.ctx=t,this.active=e}postPhysics(t,e){if(this.active){var i,s,[n,r]=[this.ctx.canvas.width,this.ctx.canvas.height];for(const o of e)o instanceof l&&(i=h(new d(0,0),n,r),s=h(new d(n,r),n,r),o.coords.x-l.radius<=i.x?o.coords=new d(i.x+l.radius,o.coords.y):o.coords.x+l.radius>=s.x&&(o.coords=new d(s.x-l.radius,o.coords.y)),o.coords.y-l.radius<=i.y?o.coords=new d(o.coords.x,i.y+l.radius):o.coords.y+l.radius>=s.y&&(o.coords=new d(o.coords.x,s.y-l.radius)))}}}class f{constructor(){this.pendingRenders=new Map}pend(t,e=0){this.pendingRenders.has(e)||this.pendingRenders.set(e,[]),this.pendingRenders.get(e).push(t)}render(){for(const t of Array.from(this.pendingRenders.keys()).sort((t,e)=>t-e))this.pendingRenders.get(t).forEach(t=>t());this.pendingRenders.clear()}}class v{constructor(t){this.deleted=!1,this.ctx=t,this.renderable=[],this.movable=[],this.inputable=[this],this.inputQueue=[],this.prevTime=Date.now(),this.curTime=Date.now(),this.dTMultiplier=0,this.unfinishedEdge=null,this.renderer=new f,this.clearScene();t=0===this.dTMultiplier?v.pauseColor:v.activeColor;this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}clearScene(){this.renderable=[],this.movable=[],this.inputable=[this],this.unfinishedEdge=null,this.addObject(new y(!0)),this.addObject(new e(this.ctx,!1))}addObject(t){var e;"render"in(e=t)&&"function"==typeof e.render&&this.renderable.push(t),("prePhysics"in(e=t)&&"function"==typeof e.prePhysics||"applyForce"in e&&"function"==typeof e.applyForce||"applyVelocity"in e&&"function"==typeof e.applyVelocity||"applyCoords"in e&&"function"==typeof e.applyCoords||"postPhysics"in e&&"function"==typeof e.postPhysics)&&this.movable.push(t),"applyInput"in(e=t)&&"function"==typeof e.applyInput&&this.inputable.push(t)}findTargetedVertex(t){let e=null;for(const i of this.renderable)if(i instanceof l&&i.isInsideVertex(t)){e=i;break}return e}addInput(t){var e,i;t instanceof MouseEvent&&([e,i]=[this.ctx.canvas.width,this.ctx.canvas.height],t=new o(t,e,i)),this.inputQueue.push(t)}applyInput(t){if(t instanceof KeyboardEvent)"keydown"!==t.type||"Space"!==t.code||t.repeat?"keydown"===t.type&&"KeyW"===t.code&&this.clearScene():this.dTMultiplier=1===this.dTMultiplier?0:1;else if(t instanceof o)if("dblclick"===t.type)this.addObject(new l(new d(t.physicsX,t.physicsY),r(),.01,this.renderer));else if("mousedown"===t.type&&t.shiftKey){var e=this.findTargetedVertex(new d(t.physicsX,t.physicsY));e&&(this.unfinishedEdge=new u(e,this.renderer),this.addObject(this.unfinishedEdge))}else if("mouseup"===t.type&&this.unfinishedEdge){const i=this.findTargetedVertex(new d(t.physicsX,t.physicsY));i&&!this.movable.some(t=>t instanceof p&&t.vertices.includes(i)&&t.vertices.includes(this.unfinishedEdge.from))&&this.addObject(new p(this.unfinishedEdge.from,i,1,this.renderer)),this.unfinishedEdge.deleted=!0,this.unfinishedEdge=null}}update(){this.prevTime=this.curTime,this.curTime=Date.now();const i=(this.curTime-this.prevTime)*this.dTMultiplier/1e3;for(const e of this.inputQueue)this.inputable.forEach(t=>t.applyInput(e,this.ctx));this.movable=this.movable.filter(t=>!t.deleted),this.renderable=this.renderable.filter(t=>!t.deleted),this.inputable=this.inputable.filter(t=>!t.deleted),this.inputQueue=[],this.movable.forEach(t=>{var e;return null==(e=t.prePhysics)?void 0:e.call(t)}),this.movable.forEach(t=>{var e;return null==(e=t.applyForce)?void 0:e.call(t,i,this.movable)}),this.movable.forEach(t=>{var e;return null==(e=t.applyVelocity)?void 0:e.call(t,i,this.movable)}),this.movable.forEach(t=>{var e;return null==(e=t.applyCoords)?void 0:e.call(t,i,this.movable)}),this.movable.forEach(t=>{var e;return null==(e=t.postPhysics)?void 0:e.call(t,i,this.movable)});var t=0===this.dTMultiplier?v.pauseColor:v.activeColor;this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.renderable.forEach(t=>t.render(this.ctx)),this.renderer.render()}}v.pauseColor="#EAEAEA",v.activeColor="white";{const g=document.querySelector("canvas");g.width=window.innerWidth,g.height=window.innerHeight;var w=g.getContext("2d");const m=new v(w);window.addEventListener("resize",function(t){g.width=window.innerWidth,g.height=window.innerHeight}),document.addEventListener("keydown",function(t){m.addInput(t)}),g.addEventListener("dblclick",function(t){m.addInput(t)}),g.addEventListener("mousedown",function(t){m.addInput(t)}),g.addEventListener("mouseup",function(t){m.addInput(t)}),g.addEventListener("mousemove",function(t){m.addInput(t)}),g.addEventListener("click",function(t){m.addInput(t)}),function t(){m.update(),requestAnimationFrame(t)}()}}();